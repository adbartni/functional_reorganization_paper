---
title: "Comparative Network Analyses"
author: "Alex Bartnik"
date: "April 30, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Load dependencies}

dependencies <- c(
  "dplyr",
  "tidyr",
  "ggplot2"
)

for (package in dependencies) {
  if (!package %in% (.packages())) {
    library(package,
            character.only = T)
  }
}

if (!exists("fcDev")) {
  source('../scripts/getData.R')
  source('../scripts/preprocessing.R')
}
source('../scripts/getNetworkConnections.R')

```

```{r}

setwd('/home/alex/R/scatters/')
gatherAllPairsPerNetwork <- function(network.name) {
  
  internetworkpairs <- getInterNetworkPairs(getNetworkRegions(network.name))
  intranetworkpairs <- getIntraNetworkPairs(getNetworkRegions(network.name))

  subjects <- intersect(rownames(fcDev), rownames(dti))
  disease.group <- disease.groups[subjects,]
  
  combinePairs <- function(inputData, source.name, inter.network, intra.network, disease.group) {
    rbind(
      cbind(inputData[subjects, inter.network], disease.group) %>%
        mutate(subject = subjects) %>%
        gather(
          key = "pair",
          value = source.name,
          -subject, -disease.group
        ) %>%
        mutate(location = "Internetwork"),
      cbind(inputData[subjects, intra.network], disease.group) %>%
        mutate(subject = subjects) %>%
        gather(
          key = "pair",
          value = source.name,
          -subject, -disease.group
        ) %>%
        mutate(location = "Intranetwork")
    ) %>%
      group_by(subject, location, disease.group) %>%
      summarise(source.name = mean(inputData))
  }
  
  network.fcDev <- combinePairs(
    fcDev,
    "fcDev",
    getInterNetworkPairs(getNetworkRegions(network.name)),
    getIntraNetworkPairs(getNetworkRegions(network.name)),
    disease.group
  )
  network.dti <- combinePairs(
    dti,
    "dti",
    getInterNetworkPairs(getNetworkRegions(network.name)),
    getIntraNetworkPairs(getNetworkRegions(network.name)),
    disease.group
  )
  network <- merge(network.fcDev, network.dti)
  
  return (network)
  
}

gatherAllPairsPerNetwork("DMN")

```

```{r}

ggplot(dmn,
       aes(x = dti,
           y = fcDev,
           color = dmn.disease.groups)) + 
  geom_point() + 
  facet_grid(. ~ location)

```

```{r}

setwd('/home/alex/R/scatters/')
for (network in smith.networks) {
  plotNetworkSums(network, "Diffusion")
}

```




